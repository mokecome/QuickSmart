# QuickSmart æ™ºèƒ½è¨˜å¸³ - User Stories (BDD æ ¼å¼)

**ç‰ˆæœ¬**: v1.0
**æ—¥æœŸ**: 2025-10-20
**åŸºæ–¼**: EVENT_STORMING.md

---

## ğŸ“‹ ç›®éŒ„

1. [User Story æ¦‚è¦½](#user-story-æ¦‚è¦½)
2. [Epic 1: å¿«é€Ÿè¨˜å¸³](#epic-1-å¿«é€Ÿè¨˜å¸³)
3. [Epic 2: è¨‚é–±ç®¡ç†](#epic-2-è¨‚é–±ç®¡ç†)
4. [Epic 3: ç”¨æˆ¶æ—…ç¨‹](#epic-3-ç”¨æˆ¶æ—…ç¨‹)
5. [Epic 4: æ™ºèƒ½åˆ†æ](#epic-4-æ™ºèƒ½åˆ†æ)
6. [Epic 5: ç³»çµ±ç©©å®šæ€§](#epic-5-ç³»çµ±ç©©å®šæ€§)
7. [Story ç›¸ä¾æ€§åœ–](#story-ç›¸ä¾æ€§åœ–)
8. [Sprint è¦åŠƒå»ºè­°](#sprint-è¦åŠƒå»ºè­°)

---

## ğŸ¯ User Story æ¦‚è¦½

### Story Point ä¼°ç®—æ¨™æº–

| Points | è¤‡é›œåº¦ | å·¥æ™‚ | ç¯„ä¾‹ |
|--------|--------|------|------|
| 1 | ç°¡å–® | 2-4h | ç°¡å–® CRUDã€UI èª¿æ•´ |
| 2 | ç°¡å–®åä¸­ | 4-8h | å«é©—è­‰çš„ CRUD |
| 3 | ä¸­ç­‰ | 1-2 days | ç°¡å–®æ¥­å‹™é‚è¼¯ + API |
| 5 | ä¸­ç­‰åé«˜ | 2-3 days | è¤‡é›œæ¥­å‹™é‚è¼¯ + æ•´åˆ |
| 8 | é«˜ | 3-5 days | æ ¸å¿ƒåŠŸèƒ½ + å¤–éƒ¨æ•´åˆ |
| 13 | æ¥µé«˜ | 1-2 weeks | éœ€æ‹†åˆ† |

### INVEST åŸå‰‡æª¢æŸ¥æ¸…å–®

- **I**ndependent: å¯ç¨ç«‹é–‹ç™¼èˆ‡æ¸¬è©¦
- **N**egotiable: ç´°ç¯€å¯èˆ‡ PO å”å•†
- **V**aluable: ç‚ºç”¨æˆ¶å‰µé€ åƒ¹å€¼
- **E**stimable: å¯ä¼°ç®—å·¥ä½œé‡
- **S**mall: å¯åœ¨ä¸€å€‹ Sprint å…§å®Œæˆ
- **T**estable: æœ‰æ˜ç¢ºçš„é©—æ”¶æ¢ä»¶

---

## Epic 1: å¿«é€Ÿè¨˜å¸³

### Story 1.1: AI è‡ªç„¶èªè¨€è§£æè¨˜å¸³

**Story ID**: ES-001
**Epic**: å¿«é€Ÿè¨˜å¸³
**Priority**: P0 (Must Have)
**Story Points**: 8

#### User Story

```
As a å¿™ç¢Œçš„ä¸Šç­æ—
I want è¼¸å…¥è‡ªç„¶èªè¨€å¿«é€Ÿè¨˜å¸³ï¼ˆå¦‚ "æ—©é¤ 65"ï¼‰
So that æˆ‘å¯ä»¥åœ¨ 3 ç§’å…§å®Œæˆè¨˜å¸³ï¼Œä¸éœ€è¦æ‰‹å‹•é¸æ“‡åˆ†é¡
```

#### Acceptance Criteria

##### AC1: æˆåŠŸè§£æç°¡å–®è¨˜å¸³è¼¸å…¥

```gherkin
Given ç”¨æˆ¶å·²ç™»å…¥ QuickSmart
  And AI æœå‹™æ­£å¸¸é‹ä½œ
When ç”¨æˆ¶è¼¸å…¥ "æ—©é¤ 65"
Then ç³»çµ±æ‡‰åœ¨ 500ms å…§å›æ‡‰
  And è§£æçµæœæ‡‰ç‚º:
    | æ¬„ä½        | å€¼      |
    | amount      | 65      |
    | category    | FOOD    |
    | confidence  | >= 95%  |
  And æ‡‰é¡¯ç¤ºæˆåŠŸé€šçŸ¥ "âœ¨ å·²è¨˜å¸³!"
  And æ‡‰è§¸ç™¼ ExpenseCreated äº‹ä»¶
```

##### AC2: æˆåŠŸè§£æè¤‡é›œè¼¸å…¥ï¼ˆå«æ™‚é–“ã€åœ°é»ï¼‰

```gherkin
Given ç”¨æˆ¶å·²ç™»å…¥
When ç”¨æˆ¶è¼¸å…¥ "æ˜¨å¤©æ™šä¸Šåœ¨èª å“è²·æ›¸ 450"
Then è§£æçµæœæ‡‰ç‚º:
    | æ¬„ä½        | å€¼              |
    | amount      | 450             |
    | category    | SHOPPING        |
    | date        | æ˜¨å¤©            |
    | description | èª å“è²·æ›¸        |
    | confidence  | >= 90%          |
```

##### AC3: ä½ä¿¡å¿ƒåº¦æ™‚è¦æ±‚ç”¨æˆ¶ç¢ºèª

```gherkin
Given ç”¨æˆ¶å·²ç™»å…¥
When ç”¨æˆ¶è¼¸å…¥ "xyz 100"
  And AI ä¿¡å¿ƒåº¦ < 80%
Then ç³»çµ±æ‡‰é¡¯ç¤ºç¢ºèªå°è©±æ¡†
  And å»ºè­°åˆ†é¡æ‡‰åˆ—å‡º 3 å€‹é¸é …
  And ç”¨æˆ¶æ‡‰å¯æ‰‹å‹•é¸æ“‡åˆ†é¡
```

##### AC4: æ”¯æ´å¤šç¨®é‡‘é¡æ ¼å¼

```gherkin
Given ç”¨æˆ¶å·²ç™»å…¥
When ç”¨æˆ¶è¼¸å…¥ä»¥ä¸‹ä»»ä¸€æ ¼å¼:
    | è¼¸å…¥           |
    | "åˆé¤ 65"      |
    | "åˆé¤ $65"     |
    | "åˆé¤ NT$65"   |
    | "åˆé¤ 65å…ƒ"    |
Then æ‰€æœ‰è¼¸å…¥æ‡‰è§£æå‡º amount = 65
```

#### Technical Notes

- ä½¿ç”¨ Claude API (Sonnet 3.5)
- è¶…æ™‚è¨­å®š: 10 ç§’
- Rate Limit: 60 req/min
- å¿«å–ç›¸åŒè¼¸å…¥ 5 åˆ†é˜

#### Definition of Done

- [ ] Unit Test è¦†è“‹ç‡ >= 90%
- [ ] Integration Test æ¶µè“‹ AC1-AC4
- [ ] API Response Time P95 < 1s
- [ ] éŒ¯èª¤è™•ç†å®Œæ•´ï¼ˆç¶²è·¯éŒ¯èª¤ã€è¶…æ™‚ã€API å¤±æ•ˆï¼‰
- [ ] Monitoring Dashboard è¨­å®šå®Œæˆ

#### Dependencies

- éœ€è¦: US-005 (ç”¨æˆ¶è¨»å†Šç™»å…¥)
- é˜»æ“‹: US-002 (AI é™ç´šæ©Ÿåˆ¶)

---

### Story 1.2: AI æœå‹™é™ç´šæ©Ÿåˆ¶

**Story ID**: ES-002
**Epic**: å¿«é€Ÿè¨˜å¸³
**Priority**: P0 (Must Have)
**Story Points**: 5

#### User Story

```
As a ç³»çµ±ç®¡ç†å“¡
I want ç•¶ AI æœå‹™å¤±æ•ˆæ™‚è‡ªå‹•åˆ‡æ›åˆ°è¦å‰‡å¼•æ“
So that ç”¨æˆ¶å¯ä»¥æŒçºŒä½¿ç”¨è¨˜å¸³åŠŸèƒ½è€Œä¸ä¸­æ–·
```

#### Acceptance Criteria

##### AC1: AI è¶…æ™‚æ™‚å•Ÿå‹•é™ç´šæ¨¡å¼

```gherkin
Given AI æœå‹™å·²è¨­å®š 10 ç§’è¶…æ™‚
  And è¦å‰‡å¼•æ“å·²é…ç½®å®Œæˆ
When Claude API å›æ‡‰è¶…é 10 ç§’
Then ç³»çµ±æ‡‰è‡ªå‹•åˆ‡æ›åˆ°è¦å‰‡å¼•æ“
  And æ‡‰è§¸ç™¼ FallbackModeActivated äº‹ä»¶
  And æ‡‰è¨˜éŒ„åˆ° Sentry
  And ç”¨æˆ¶æ‡‰çœ‹åˆ°æç¤º "AI æš«æ™‚ä¼‘æ¯ä¸­,å·²åˆ‡æ›åŸºæœ¬æ¨¡å¼"
```

##### AC2: AI éŒ¯èª¤æ™‚å•Ÿå‹•é™ç´šæ¨¡å¼

```gherkin
Given AI æœå‹™æ­£å¸¸é‹ä½œä¸­
When Claude API å›æ‡‰ 503 Service Unavailable
Then ç³»çµ±æ‡‰ç«‹å³åˆ‡æ›åˆ°è¦å‰‡å¼•æ“
  And è§£æçµæœæ‡‰æ¨™è¨˜ fallbackUsed = true
  And confidence æ‡‰è¨­ç‚º 70%
```

##### AC3: è¦å‰‡å¼•æ“æˆåŠŸè§£æå¸¸è¦‹æ¨¡å¼

```gherkin
Given é™ç´šæ¨¡å¼å·²å•Ÿå‹•
When ç”¨æˆ¶è¼¸å…¥ä»¥ä¸‹å¸¸è¦‹æ¨¡å¼:
    | è¼¸å…¥           | æœŸæœ›åˆ†é¡   |
    | "æ—©é¤ 65"      | FOOD       |
    | "æ·é‹ 20"      | TRANSPORT  |
    | "Netflix 390"  | ENTERTAINMENT |
Then æ‰€æœ‰è¼¸å…¥æ‡‰æ­£ç¢ºè§£æ
  And confidence æ‡‰ç‚º 70%
  And fallbackUsed æ‡‰ç‚º true
```

##### AC4: é™ç´šæ¨¡å¼ç›£æ§å‘Šè­¦

```gherkin
Given é™ç´šæ¨¡å¼å·²å•Ÿå‹•
When é€£çºŒ 10 åˆ†é˜ä½¿ç”¨é™ç´šæ¨¡å¼
Then ç³»çµ±æ‡‰ç™¼é€ Slack å‘Šè­¦çµ¦æŠ€è¡“åœ˜éšŠ
  And ç›£æ§ Dashboard æ‡‰é¡¯ç¤ºç´…è‰²è­¦ç¤º
```

#### Technical Notes

- è¦å‰‡å¼•æ“ä½¿ç”¨æ­£å‰‡è¡¨é”å¼ + é—œéµå­—åŒ¹é…
- ç¶­è­·é—œéµå­—å­—å…¸ (foods.json, transports.json...)
- ç›£æ§ä½¿ç”¨ Sentry + Prometheus

#### Definition of Done

- [ ] Unit Test è¦†è“‹ç‡ >= 95%
- [ ] æ¨¡æ“¬ AI å¤±æ•ˆçš„ Integration Test
- [ ] è¦å‰‡å¼•æ“æº–ç¢ºç‡æ¸¬è©¦ >= 75%
- [ ] Sentry æ•´åˆå®Œæˆ
- [ ] Runbook æ–‡ä»¶å®Œæˆ

#### Dependencies

- è¢«é˜»æ“‹æ–¼: US-001 (AI è§£æ)

---

### Story 1.3: åˆ†é¡ä¿®æ­£èˆ‡ AI å­¸ç¿’

**Story ID**: ES-003
**Epic**: å¿«é€Ÿè¨˜å¸³
**Priority**: P1 (Should Have)
**Story Points**: 5

#### User Story

```
As a ç”¨æˆ¶
I want ä¿®æ­£ AI éŒ¯èª¤çš„åˆ†é¡
So that AI å¯ä»¥å­¸ç¿’æˆ‘çš„ç¿’æ…£,æœªä¾†æ›´æº–ç¢º
```

#### Acceptance Criteria

##### AC1: ä¿®æ­£åˆ†é¡æˆåŠŸ

```gherkin
Given ç”¨æˆ¶æœ‰ä¸€ç­†æ”¯å‡ºè¨˜éŒ„
  And åˆ†é¡ç‚º ENTERTAINMENT (AI è‡ªå‹•åˆ†é¡)
When ç”¨æˆ¶é»æ“Šè©²è¨˜éŒ„
  And å°‡åˆ†é¡æ”¹ç‚º TRANSPORT
  And é»æ“Šç¢ºèª
Then è¨˜éŒ„æ‡‰æ›´æ–°ç‚º TRANSPORT
  And æ‡‰è§¸ç™¼ CategoryCorrected äº‹ä»¶
  And version æ¬„ä½æ‡‰ +1
  And æ‡‰é¡¯ç¤ºé€šçŸ¥ "AI æœƒè¨˜ä½é€™å€‹ä¿®æ­£ ğŸ§ "
```

##### AC2: å­¸ç¿’æ¨£æœ¬å„²å­˜

```gherkin
Given ç”¨æˆ¶ä¿®æ­£äº†åˆ†é¡
When CategoryCorrected äº‹ä»¶è§¸ç™¼
Then ç³»çµ±æ‡‰å„²å­˜å­¸ç¿’æ¨£æœ¬:
    | æ¬„ä½            | å€¼                    |
    | inputText       | åŸå§‹è¼¸å…¥æ–‡å­—          |
    | correctCategory | TRANSPORT             |
    | userId          | ç•¶å‰ç”¨æˆ¶ ID           |
    | timestamp       | ä¿®æ­£æ™‚é–“              |
  And æ‡‰è§¸ç™¼ AILearned äº‹ä»¶
```

##### AC3: å¤šæ¬¡ä¿®æ­£å¾Œæ”¹å–„æº–ç¢ºç‡

```gherkin
Given ç”¨æˆ¶å·²ä¿®æ­£ "Uber å›å®¶ 120" ç‚º TRANSPORT 5 æ¬¡
When ç”¨æˆ¶å†æ¬¡è¼¸å…¥ "Uber å»å…¬å¸ 95"
Then AI æ‡‰æ­£ç¢ºåˆ†é¡ç‚º TRANSPORT
  And confidence æ‡‰ >= 95%
```

##### AC4: ä¿®æ­£æ­·å²è¨˜éŒ„æŸ¥è©¢

```gherkin
Given ç”¨æˆ¶å·²ä¿®æ­£å¤šç­†åˆ†é¡
When ç”¨æˆ¶é€²å…¥è¨­å®šé é¢
  And é»æ“Š "AI å­¸ç¿’è¨˜éŒ„"
Then æ‡‰é¡¯ç¤ºæœ€è¿‘ 20 ç­†ä¿®æ­£è¨˜éŒ„
  And æ¯ç­†æ‡‰é¡¯ç¤º:
    | æ¬„ä½        |
    | åŸå§‹è¼¸å…¥    |
    | åŸåˆ†é¡      |
    | ä¿®æ­£å¾Œåˆ†é¡  |
    | ä¿®æ­£æ™‚é–“    |
```

#### Technical Notes

- å­¸ç¿’æ¨£æœ¬å„²å­˜è‡³ learning_samples è¡¨
- å®šæœŸï¼ˆæ¯é€±ï¼‰æ‰¹æ¬¡æ›´æ–° AI æç¤ºè©
- ç”¨æˆ¶å€‹äººåŒ–æ¨¡å‹ï¼ˆV1.1 åŠŸèƒ½ï¼‰

#### Definition of Done

- [ ] Unit Test: correctCategory() æ–¹æ³•
- [ ] Integration Test: å®Œæ•´ä¿®æ­£æµç¨‹
- [ ] E2E Test: UI ä¿®æ­£æ“ä½œ
- [ ] è³‡æ–™åº« Migration Script
- [ ] å­¸ç¿’æ•ˆæœ A/B Test è¨­è¨ˆæ–‡ä»¶

#### Dependencies

- éœ€è¦: US-001 (AI è§£æ)

---

### Story 1.4: æ”¯å‡ºè¨˜éŒ„ CRUD

**Story ID**: ES-004
**Epic**: å¿«é€Ÿè¨˜å¸³
**Priority**: P0 (Must Have)
**Story Points**: 3

#### User Story

```
As a ç”¨æˆ¶
I want æŸ¥çœ‹ã€ç·¨è¼¯ã€åˆªé™¤æˆ‘çš„æ”¯å‡ºè¨˜éŒ„
So that æˆ‘å¯ä»¥ç®¡ç†æˆ‘çš„è²¡å‹™è³‡æ–™
```

#### Acceptance Criteria

##### AC1: æŸ¥çœ‹æ”¯å‡ºåˆ—è¡¨ï¼ˆåˆ†é ï¼‰

```gherkin
Given ç”¨æˆ¶æœ‰ 100 ç­†æ”¯å‡ºè¨˜éŒ„
When ç”¨æˆ¶é–‹å•Ÿæ”¯å‡ºé é¢
Then æ‡‰é¡¯ç¤ºæœ€è¿‘ 20 ç­†è¨˜éŒ„ï¼ˆä¾æ—¥æœŸé™å†ªï¼‰
  And æ‡‰é¡¯ç¤ºåˆ†é æ§åˆ¶å…ƒä»¶
  And æ¯ç­†è¨˜éŒ„æ‡‰é¡¯ç¤º:
    | æ¬„ä½        |
    | æ—¥æœŸ        |
    | é‡‘é¡        |
    | åˆ†é¡åœ–ç¤º    |
    | æè¿°        |
```

##### AC2: ç·¨è¼¯æ”¯å‡ºè¨˜éŒ„

```gherkin
Given ç”¨æˆ¶é»æ“Šä¸€ç­†æ”¯å‡ºè¨˜éŒ„
When ç”¨æˆ¶ä¿®æ”¹é‡‘é¡ç‚º 200
  And ä¿®æ”¹åˆ†é¡ç‚º SHOPPING
  And é»æ“Šå„²å­˜
Then è¨˜éŒ„æ‡‰æˆåŠŸæ›´æ–°
  And version æ‡‰ +1
  And æ‡‰è§¸ç™¼ ExpenseUpdated äº‹ä»¶
  And æ‡‰é¡¯ç¤ºé€šçŸ¥ "å·²æ›´æ–°"
```

##### AC3: åˆªé™¤æ”¯å‡ºè¨˜éŒ„

```gherkin
Given ç”¨æˆ¶é»æ“Šä¸€ç­†æ”¯å‡ºè¨˜éŒ„
When ç”¨æˆ¶é»æ“Šåˆªé™¤æŒ‰éˆ•
  And ç¢ºèªåˆªé™¤å°è©±æ¡†
Then è¨˜éŒ„æ‡‰è¢«è»Ÿåˆªé™¤ï¼ˆdeletedAt æ¬„ä½ï¼‰
  And æ‡‰è§¸ç™¼ ExpenseDeleted äº‹ä»¶
  And åˆ—è¡¨æ‡‰ç§»é™¤è©²è¨˜éŒ„
  And æ‡‰é¡¯ç¤ºé€šçŸ¥ "å·²åˆªé™¤"
```

##### AC4: ç¯©é¸èˆ‡æœå°‹

```gherkin
Given ç”¨æˆ¶åœ¨æ”¯å‡ºé é¢
When ç”¨æˆ¶é¸æ“‡åˆ†é¡ FOOD
  And è¨­å®šæ—¥æœŸç¯„åœ 2025-10-01 to 2025-10-20
Then æ‡‰åªé¡¯ç¤ºç¬¦åˆæ¢ä»¶çš„è¨˜éŒ„
  And æ‡‰é¡¯ç¤ºç¸½é‡‘é¡çµ±è¨ˆ
```

#### Technical Notes

- è»Ÿåˆªé™¤æ©Ÿåˆ¶ï¼ˆdeletedAtï¼‰
- åˆ†é : 20 ç­†/é 
- å¿«å–ç­–ç•¥: Redis 5 åˆ†é˜

#### Definition of Done

- [ ] Unit Test: CRUD æ–¹æ³•
- [ ] Integration Test: API ç«¯é»
- [ ] E2E Test: UI æ“ä½œæµç¨‹
- [ ] API æ–‡ä»¶å®Œæˆ
- [ ] æ•ˆèƒ½æ¸¬è©¦: 1000 ç­†è³‡æ–™è¼‰å…¥ < 1s

#### Dependencies

- éœ€è¦: US-001 (AI è§£æ)

---

## Epic 2: è¨‚é–±ç®¡ç†

### Story 2.1: æ–°å¢è¨‚é–±æœå‹™

**Story ID**: ES-010
**Epic**: è¨‚é–±ç®¡ç†
**Priority**: P1 (Should Have)
**Story Points**: 5

#### User Story

```
As a ç”¨æˆ¶
I want æ–°å¢å®šæœŸæ‰£æ¬¾çš„è¨‚é–±æœå‹™ï¼ˆå¦‚ Netflix, Spotifyï¼‰
So that ç³»çµ±å¯ä»¥è‡ªå‹•æé†’æˆ‘æ‰£æ¬¾æ—¥æœŸ,é¿å…å¿˜è¨˜
```

#### Acceptance Criteria

##### AC1: æˆåŠŸæ–°å¢æœˆè¨‚é–±

```gherkin
Given ç”¨æˆ¶å·²ç™»å…¥
When ç”¨æˆ¶å¡«å¯«è¨‚é–±è¡¨å–®:
    | æ¬„ä½            | å€¼             |
    | name            | Netflix        |
    | amount          | 390            |
    | billingCycle    | MONTHLY        |
    | firstBillingDate| 2025-10-15     |
  And é»æ“Šå„²å­˜
Then è¨‚é–±æ‡‰æˆåŠŸå‰µå»º
  And æ‡‰è§¸ç™¼ SubscriptionAdded äº‹ä»¶
  And æ‡‰è‡ªå‹•è¨ˆç®— nextBillingDate = 2025-11-15
  And æ‡‰è§¸ç™¼ BillingDateCalculated äº‹ä»¶
  And æ‡‰é¡¯ç¤ºé€šçŸ¥ "å·²æ–°å¢è¨‚é–±"
```

##### AC2: æˆåŠŸæ–°å¢å¹´è¨‚é–±

```gherkin
Given ç”¨æˆ¶å¡«å¯«è¨‚é–±è¡¨å–®:
    | name            | iCloud         |
    | amount          | 990            |
    | billingCycle    | YEARLY         |
    | firstBillingDate| 2025-02-29     |
When é»æ“Šå„²å­˜
Then nextBillingDate æ‡‰ç‚º 2026-02-28ï¼ˆéé–å¹´ï¼‰
  And æ‡‰è§¸ç™¼ç›¸é—œäº‹ä»¶
```

##### AC3: è¡¨å–®é©—è­‰

```gherkin
Given ç”¨æˆ¶å¡«å¯«è¨‚é–±è¡¨å–®
When æ¬„ä½é©—è­‰å¤±æ•—:
    | æƒ…å¢ƒ                | éŒ¯èª¤è¨Šæ¯              |
    | name ç‚ºç©º           | "è«‹è¼¸å…¥æœå‹™åç¨±"      |
    | amount <= 0         | "é‡‘é¡å¿…é ˆå¤§æ–¼ 0"      |
    | firstBillingDate ç‚ºéå» | "è«‹é¸æ“‡ä»Šå¤©æˆ–æœªä¾†æ—¥æœŸ" |
Then æ‡‰é¡¯ç¤ºå°æ‡‰éŒ¯èª¤è¨Šæ¯
  And ä¸æ‡‰æäº¤è¡¨å–®
```

##### AC4: è¨‚é–±åˆ—è¡¨é¡¯ç¤º

```gherkin
Given ç”¨æˆ¶å·²æ–°å¢ 3 å€‹è¨‚é–±
When ç”¨æˆ¶é€²å…¥è¨‚é–±é é¢
Then æ‡‰é¡¯ç¤ºæ‰€æœ‰è¨‚é–±
  And æ¯å€‹è¨‚é–±æ‡‰é¡¯ç¤º:
    | æ¬„ä½            |
    | æœå‹™åç¨±        |
    | é‡‘é¡            |
    | é€±æœŸï¼ˆæœˆ/å¹´ï¼‰   |
    | ä¸‹æ¬¡æ‰£æ¬¾æ—¥      |
    | è·é›¢æ‰£æ¬¾å¤©æ•¸    |
```

#### Technical Notes

- ä½¿ç”¨ date-fns è™•ç†æ—¥æœŸè¨ˆç®—
- å„²å­˜æ™‚å€è³‡è¨Šï¼ˆç”¨æˆ¶ç•¶åœ°æ™‚å€ï¼‰

#### Definition of Done

- [ ] Unit Test: Subscription èšåˆæ–¹æ³•
- [ ] Integration Test: POST /api/subscriptions
- [ ] E2E Test: å®Œæ•´æ–°å¢æµç¨‹
- [ ] æ—¥æœŸè¨ˆç®—é‚Šç•Œæ¡ˆä¾‹æ¸¬è©¦ï¼ˆé–å¹´ã€æœˆåº•ï¼‰
- [ ] API æ–‡ä»¶å®Œæˆ

#### Dependencies

- éœ€è¦: US-005 (ç”¨æˆ¶ç™»å…¥)
- é˜»æ“‹: US-011 (æ‰£æ¬¾æé†’)

---

### Story 2.2: è¨‚é–±æ‰£æ¬¾æé†’

**Story ID**: ES-011
**Epic**: è¨‚é–±ç®¡ç†
**Priority**: P1 (Should Have)
**Story Points**: 8

#### User Story

```
As a ç”¨æˆ¶
I want åœ¨è¨‚é–±æ‰£æ¬¾å‰ 3 å¤©ã€1 å¤©ã€ç•¶å¤©æ”¶åˆ°é€šçŸ¥
So that æˆ‘å¯ä»¥æå‰æº–å‚™è³‡é‡‘æˆ–å–æ¶ˆä¸éœ€è¦çš„è¨‚é–±
```

#### Acceptance Criteria

##### AC1: æ‰£æ¬¾å‰ 3 å¤©æ¨æ’­é€šçŸ¥

```gherkin
Given ä»Šå¤©æ˜¯ 2025-10-12
  And ç”¨æˆ¶æœ‰ Netflix è¨‚é–±,ä¸‹æ¬¡æ‰£æ¬¾æ—¥ç‚º 2025-10-15
When Cron Job åœ¨æ¯æ—¥ 00:00 åŸ·è¡Œ
Then ç³»çµ±æ‡‰ç™¼é€æ¨æ’­é€šçŸ¥:
    | æ¨™é¡Œ        | "Netflix å³å°‡æ‰£æ¬¾"           |
    | å…§å®¹        | "å°‡åœ¨ 3 å¤©å¾Œæ‰£æ¬¾ NT$390"     |
    | æ·±å±¤é€£çµ    | /subscriptions/{id}          |
  And æ‡‰è§¸ç™¼ BillingReminderSent äº‹ä»¶
```

##### AC2: æ‰£æ¬¾å‰ 1 å¤©æ¨æ’­é€šçŸ¥

```gherkin
Given ä»Šå¤©æ˜¯ 2025-10-14
  And Netflix ä¸‹æ¬¡æ‰£æ¬¾æ—¥ç‚º 2025-10-15
When Cron Job åŸ·è¡Œ
Then æ‡‰ç™¼é€æé†’ "å°‡åœ¨ 1 å¤©å¾Œæ‰£æ¬¾ NT$390"
```

##### AC3: æ‰£æ¬¾ç•¶å¤©é€šçŸ¥

```gherkin
Given ä»Šå¤©æ˜¯ 2025-10-15ï¼ˆæ‰£æ¬¾æ—¥ï¼‰
When Cron Job åŸ·è¡Œ
Then æ‡‰ç™¼é€é€šçŸ¥ "ä»Šå¤©å°‡æ‰£æ¬¾ NT$390"
  And æ‡‰è‡ªå‹•å‰µå»ºæ”¯å‡ºè¨˜éŒ„
  And æ‡‰è§¸ç™¼ ExpenseAutoCreated äº‹ä»¶
```

##### AC4: Email å‚™æ´é€šçŸ¥

```gherkin
Given ç”¨æˆ¶çš„æ¨æ’­é€šçŸ¥ç™¼é€å¤±æ•—
When é‡è©¦ 3 æ¬¡ä»å¤±æ•—
Then ç³»çµ±æ‡‰ç™¼é€ Email é€šçŸ¥
  And Email ä¸»é¡Œæ‡‰ç‚º "Netflix å³å°‡æ‰£æ¬¾"
  And Email æ‡‰åŒ…å«å®Œæ•´è¨‚é–±è³‡è¨Š
```

##### AC5: Cron Job å®¹éŒ¯æ©Ÿåˆ¶

```gherkin
Given Cron Job å› ç³»çµ±æ•…éšœæœªåŸ·è¡Œ
When ç³»çµ±æ¢å¾©å¾Œé‡æ–°åŸ·è¡Œ
Then æ‡‰è£œç™¼æ‰€æœ‰æ¼ç™¼çš„é€šçŸ¥
  And æ‡‰è¨˜éŒ„åŸ·è¡Œæ—¥èªŒ
```

#### Technical Notes

- Cron Job: æ¯æ—¥ 00:00 (UTC+8)
- ä½¿ç”¨ node-cron æˆ– Bull Queue
- æ¨æ’­: Firebase Cloud Messaging
- Email: SendGrid

#### Definition of Done

- [ ] Unit Test: shouldSendReminder() æ–¹æ³•
- [ ] Integration Test: Cron Job åŸ·è¡Œ
- [ ] E2E Test: å®Œæ•´é€šçŸ¥æµç¨‹
- [ ] æ¨¡æ“¬ç³»çµ±æ•…éšœçš„å®¹éŒ¯æ¸¬è©¦
- [ ] Monitoring Dashboard è¨­å®š
- [ ] Runbook æ–‡ä»¶å®Œæˆ

#### Dependencies

- éœ€è¦: US-010 (æ–°å¢è¨‚é–±)
- éœ€è¦: US-015 (æ¨æ’­é€šçŸ¥åŸºç¤è¨­æ–½)

---

### Story 2.3: è¨‚é–±è‡ªå‹•è¨˜å¸³

**Story ID**: ES-012
**Epic**: è¨‚é–±ç®¡ç†
**Priority**: P1 (Should Have)
**Story Points**: 5

#### User Story

```
As a ç”¨æˆ¶
I want è¨‚é–±æ‰£æ¬¾ç•¶å¤©è‡ªå‹•å‰µå»ºæ”¯å‡ºè¨˜éŒ„
So that æˆ‘ä¸éœ€è¦æ‰‹å‹•è¨˜å¸³,è²¡å‹™è¨˜éŒ„è‡ªå‹•ä¿æŒå®Œæ•´
```

#### Acceptance Criteria

##### AC1: æ‰£æ¬¾æ—¥è‡ªå‹•å‰µå»ºæ”¯å‡º

```gherkin
Given ä»Šå¤©æ˜¯ 2025-10-15
  And Spotify è¨‚é–±,nextBillingDate = 2025-10-15
When Cron Job åŸ·è¡Œæ‰£æ¬¾é‚è¼¯
Then æ‡‰è‡ªå‹•å‰µå»ºæ”¯å‡ºè¨˜éŒ„:
    | æ¬„ä½        | å€¼                    |
    | amount      | 149                   |
    | category    | ENTERTAINMENT         |
    | description | "Spotify (è‡ªå‹•è¨˜å¸³)"  |
    | date        | 2025-10-15            |
  And æ‡‰è§¸ç™¼ SubscriptionBilled äº‹ä»¶
  And æ‡‰è§¸ç™¼ ExpenseAutoCreated äº‹ä»¶
  And Spotify.totalPaid æ‡‰å¢åŠ  149
  And Spotify.billingCount æ‡‰ +1
```

##### AC2: è¨ˆç®—ä¸‹æ¬¡æ‰£æ¬¾æ—¥

```gherkin
Given Spotify è¨‚é–±å·²æ‰£æ¬¾
When SubscriptionBilled äº‹ä»¶è™•ç†å®Œæˆ
Then æ‡‰è‡ªå‹•è¨ˆç®—ä¸‹æ¬¡æ‰£æ¬¾æ—¥:
    | billingCycle | ç•¶å‰æ—¥æœŸ   | ä¸‹æ¬¡æ‰£æ¬¾æ—¥  |
    | MONTHLY      | 2025-10-15 | 2025-11-15  |
    | YEARLY       | 2025-10-15 | 2026-10-15  |
  And æ‡‰è§¸ç™¼ BillingDateCalculated äº‹ä»¶
```

##### AC3: æœˆåº•é‚Šç•Œæ¡ˆä¾‹è™•ç†

```gherkin
Given è¨‚é–±çš„ firstBillingDate = 2025-01-31
  And billingCycle = MONTHLY
When è¨ˆç®— 2 æœˆçš„ä¸‹æ¬¡æ‰£æ¬¾æ—¥
Then nextBillingDate æ‡‰ç‚º 2025-02-28ï¼ˆéé–å¹´ï¼‰
  Or 2024-02-29ï¼ˆé–å¹´ï¼‰
```

##### AC4: æ‰£æ¬¾å¤±æ•—é€šçŸ¥

```gherkin
Given è‡ªå‹•è¨˜å¸³æµç¨‹åŸ·è¡Œ
When å‰µå»ºæ”¯å‡ºè¨˜éŒ„å¤±æ•—ï¼ˆè³‡æ–™åº«éŒ¯èª¤ï¼‰
Then æ‡‰è¨˜éŒ„éŒ¯èª¤åˆ° Sentry
  And æ‡‰ç™¼é€å‘Šè­¦çµ¦æŠ€è¡“åœ˜éšŠ
  And æ‡‰æ¨™è¨˜è©²è¨‚é–±ç‚º "éœ€è¦æ‰‹å‹•è™•ç†"
  And æ‡‰é€šçŸ¥ç”¨æˆ¶ "è‡ªå‹•è¨˜å¸³å¤±æ•—,è«‹æ‰‹å‹•ç¢ºèª"
```

#### Technical Notes

- ä½¿ç”¨äº‹å‹™ï¼ˆTransactionï¼‰ç¢ºä¿è³‡æ–™ä¸€è‡´æ€§
- å†ªç­‰æ€§è¨­è¨ˆï¼ˆé¿å…é‡è¤‡æ‰£æ¬¾ï¼‰

#### Definition of Done

- [ ] Unit Test: bill() æ–¹æ³•ï¼ˆåŒ…å«é‚Šç•Œæ¡ˆä¾‹ï¼‰
- [ ] Integration Test: å®Œæ•´è‡ªå‹•æ‰£æ¬¾æµç¨‹
- [ ] é‚Šç•Œæ¡ˆä¾‹æ¸¬è©¦ >= 20 å€‹
- [ ] éŒ¯èª¤è™•ç†æ¸¬è©¦
- [ ] å†ªç­‰æ€§æ¸¬è©¦

#### Dependencies

- éœ€è¦: US-010 (æ–°å¢è¨‚é–±)
- éœ€è¦: US-001 (æ”¯å‡º CRUD)

---

### Story 2.4: è¨‚é–±ç®¡ç†æ“ä½œ

**Story ID**: ES-013
**Epic**: è¨‚é–±ç®¡ç†
**Priority**: P2 (Could Have)
**Story Points**: 3

#### User Story

```
As a ç”¨æˆ¶
I want æš«åœã€å–æ¶ˆã€ç·¨è¼¯è¨‚é–±
So that æˆ‘å¯ä»¥éˆæ´»ç®¡ç†æˆ‘çš„å®šæœŸæ”¯å‡º
```

#### Acceptance Criteria

##### AC1: å–æ¶ˆè¨‚é–±

```gherkin
Given ç”¨æˆ¶æœ‰ Netflix è¨‚é–±
When ç”¨æˆ¶é»æ“Šå–æ¶ˆæŒ‰éˆ•
  And é¸æ“‡å–æ¶ˆåŸå›  "ä¸å†ä½¿ç”¨"
  And ç¢ºèªå–æ¶ˆ
Then è¨‚é–±ç‹€æ…‹æ‡‰æ›´æ–°ç‚º CANCELLED
  And æ‡‰è§¸ç™¼ SubscriptionCancelled äº‹ä»¶
  And æ‡‰åœæ­¢ç™¼é€æé†’
  And æ‡‰é¡¯ç¤ºé€šçŸ¥ "å·²å–æ¶ˆè¨‚é–±"
```

##### AC2: æš«åœè¨‚é–±

```gherkin
Given ç”¨æˆ¶æœ‰ Spotify è¨‚é–±
When ç”¨æˆ¶é»æ“Šæš«åœæŒ‰éˆ•
  And è¨­å®šæš«åœè‡³ 2025-12-31
Then è¨‚é–±ç‹€æ…‹æ‡‰æ›´æ–°ç‚º PAUSED
  And æ‡‰è§¸ç™¼ SubscriptionPaused äº‹ä»¶
  And æš«åœæœŸé–“ä¸æ‡‰ç™¼é€æé†’
  And 2026-01-01 æ‡‰è‡ªå‹•æ¢å¾©ç‚º ACTIVE
```

##### AC3: ç·¨è¼¯è¨‚é–±

```gherkin
Given ç”¨æˆ¶é»æ“Šç·¨è¼¯è¨‚é–±
When ç”¨æˆ¶ä¿®æ”¹é‡‘é¡ç‚º 490
  And ä¿®æ”¹ä¸‹æ¬¡æ‰£æ¬¾æ—¥ç‚º 2025-11-01
  And é»æ“Šå„²å­˜
Then è¨‚é–±æ‡‰æˆåŠŸæ›´æ–°
  And nextBillingDate æ‡‰é‡æ–°è¨ˆç®—
  And æ‡‰é¡¯ç¤ºé€šçŸ¥ "å·²æ›´æ–°è¨‚é–±"
```

##### AC4: æŸ¥çœ‹è¨‚é–±æ­·å²

```gherkin
Given ç”¨æˆ¶æœ‰ Netflix è¨‚é–±å·²æ‰£æ¬¾ 5 æ¬¡
When ç”¨æˆ¶é»æ“Šè¨‚é–±è©³æƒ…
Then æ‡‰é¡¯ç¤º:
    | æ¬„ä½            | å€¼          |
    | ç¸½æ”¯å‡º          | 1950        |
    | æ‰£æ¬¾æ¬¡æ•¸        | 5           |
    | å¹³å‡æœˆæ”¯å‡º      | 390         |
  And æ‡‰é¡¯ç¤ºæœ€è¿‘ 10 æ¬¡æ‰£æ¬¾è¨˜éŒ„
```

#### Definition of Done

- [ ] Unit Test: cancel(), pause() æ–¹æ³•
- [ ] Integration Test: PATCH /api/subscriptions/{id}
- [ ] E2E Test: UI æ“ä½œæµç¨‹
- [ ] API æ–‡ä»¶æ›´æ–°

#### Dependencies

- éœ€è¦: US-010 (æ–°å¢è¨‚é–±)

---

## Epic 3: ç”¨æˆ¶æ—…ç¨‹

### Story 3.1: ç”¨æˆ¶è¨»å†Šèˆ‡ç™»å…¥

**Story ID**: ES-005
**Epic**: ç”¨æˆ¶æ—…ç¨‹
**Priority**: P0 (Must Have)
**Story Points**: 5

#### User Story

```
As a æ–°ç”¨æˆ¶
I want ä½¿ç”¨ Google æˆ– Email è¨»å†Šç™»å…¥
So that æˆ‘å¯ä»¥å®‰å…¨åœ°å­˜å–æˆ‘çš„è¨˜å¸³è³‡æ–™
```

#### Acceptance Criteria

##### AC1: Google OAuth è¨»å†Š

```gherkin
Given ç”¨æˆ¶åœ¨ç™»å…¥é é¢
When ç”¨æˆ¶é»æ“Š "ä½¿ç”¨ Google ç™»å…¥"
  And å®Œæˆ Google OAuth æµç¨‹
Then ç³»çµ±æ‡‰å‰µå»ºç”¨æˆ¶å¸³è™Ÿ
  And æ‡‰è§¸ç™¼ UserRegistered äº‹ä»¶
  And æ‡‰è‡ªå‹•ç™»å…¥
  And æ‡‰å°å‘ Onboarding æµç¨‹
```

##### AC2: Email + å¯†ç¢¼è¨»å†Š

```gherkin
Given ç”¨æˆ¶é¸æ“‡ Email è¨»å†Š
When ç”¨æˆ¶å¡«å¯«:
    | æ¬„ä½        | å€¼                    |
    | email       | test@example.com      |
    | password    | SecurePass123!        |
  And é»æ“Šè¨»å†Š
Then æ‡‰ç™¼é€é©—è­‰ä¿¡åˆ° test@example.com
  And é©—è­‰ä¿¡æ‡‰åŒ…å«é©—è­‰é€£çµ
  And é»æ“Šé€£çµå¾Œå¸³è™Ÿæ‡‰å•Ÿç”¨
  And æ‡‰è§¸ç™¼ UserRegistered äº‹ä»¶
```

##### AC3: ç™»å…¥æˆåŠŸ

```gherkin
Given ç”¨æˆ¶å·²å®Œæˆè¨»å†Š
When ç”¨æˆ¶è¼¸å…¥æ­£ç¢ºçš„ email å’Œå¯†ç¢¼
  And é»æ“Šç™»å…¥
Then æ‡‰å‰µå»º Session
  And æ‡‰è§¸ç™¼ UserAuthenticated äº‹ä»¶
  And æ‡‰å°å‘é¦–é 
  And Session æ‡‰åœ¨ 30 å¤©å¾ŒéæœŸ
```

##### AC4: ç™»å…¥å¤±æ•—è™•ç†

```gherkin
Given ç”¨æˆ¶è¼¸å…¥éŒ¯èª¤å¯†ç¢¼
When å˜—è©¦ç™»å…¥
Then æ‡‰é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ "Email æˆ–å¯†ç¢¼éŒ¯èª¤"
  And é€£çºŒå¤±æ•— 5 æ¬¡å¾Œæ‡‰é–å®šå¸³è™Ÿ 15 åˆ†é˜
  And æ‡‰è¨˜éŒ„å¤±æ•—äº‹ä»¶åˆ° Sentry
```

#### Technical Notes

- OAuth: Passport.js + Google Strategy
- å¯†ç¢¼: bcrypt (10 rounds)
- Session: JWT (httpOnly cookie)
- Rate Limit: 5 æ¬¡/15min

#### Definition of Done

- [ ] Unit Test: AuthService æ–¹æ³•
- [ ] Integration Test: è¨»å†Š/ç™»å…¥ API
- [ ] E2E Test: å®Œæ•´ç”¨æˆ¶æµç¨‹
- [ ] å®‰å…¨æ¸¬è©¦: SQL Injection, XSS
- [ ] OWASP Top 10 æª¢æŸ¥

#### Dependencies

- é˜»æ“‹: æ‰€æœ‰åŠŸèƒ½ï¼ˆåŸºç¤è¨­æ–½ï¼‰

---

### Story 3.2: ç”¨æˆ¶å¼•å°æµç¨‹ (Onboarding)

**Story ID**: ES-006
**Epic**: ç”¨æˆ¶æ—…ç¨‹
**Priority**: P1 (Should Have)
**Story Points**: 5

#### User Story

```
As a æ–°ç”¨æˆ¶
I want ä¸€å€‹ç°¡å–®çš„å¼•å°æµç¨‹ï¼ˆ3 æ­¥é©Ÿï¼‰
So that æˆ‘å¯ä»¥å¿«é€Ÿäº†è§£ç”¢å“åŠŸèƒ½ä¸¦é–‹å§‹è¨˜å¸³
```

#### Acceptance Criteria

##### AC1: æ­¥é©Ÿ 1 - æ­¡è¿ç•«é¢

```gherkin
Given ç”¨æˆ¶å‰›å®Œæˆè¨»å†Š
When é€²å…¥ Onboarding æµç¨‹
Then æ‡‰é¡¯ç¤ºæ­¡è¿ç•«é¢:
    | å…§å®¹                            |
    | æ¨™é¡Œ: "æ­¡è¿ä½¿ç”¨ QuickSmart!"    |
    | å‰¯æ¨™é¡Œ: "3 ç§’è¨˜å¸³,AI è‡ªå‹•åˆ†é¡"  |
    | æŒ‰éˆ•: "é–‹å§‹ä½¿ç”¨"                |
  And æ‡‰è§¸ç™¼ OnboardingStarted äº‹ä»¶
```

##### AC2: æ­¥é©Ÿ 2 - åŠŸèƒ½ä»‹ç´¹

```gherkin
Given ç”¨æˆ¶åœ¨æ­¥é©Ÿ 1
When é»æ“Š "é–‹å§‹ä½¿ç”¨"
Then æ‡‰é¡¯ç¤ºåŠŸèƒ½ä»‹ç´¹ï¼ˆè¼ªæ’­ 3 é ï¼‰:
    | é é¢ | æ¨™é¡Œ              | åœ–ç¤º |
    | 1    | "è‡ªç„¶èªè¨€è¨˜å¸³"    | ğŸ’¬   |
    | 2    | "è¨‚é–±ç®¡ç†"        | ğŸ“…   |
    | 3    | "AI æ™ºèƒ½åˆ†æ"     | ğŸ§    |
  And æ¯é æ‡‰æœ‰ "ä¸‹ä¸€æ­¥" æŒ‰éˆ•
```

##### AC3: æ­¥é©Ÿ 3 - é¦–æ¬¡è¨˜å¸³

```gherkin
Given ç”¨æˆ¶åœ¨æ­¥é©Ÿ 2 æœ€å¾Œä¸€é 
When é»æ“Š "é–‹å§‹è¨˜å¸³"
Then æ‡‰é¡¯ç¤ºè¨˜å¸³è¼¸å…¥æ¡†
  And æ‡‰æœ‰æç¤ºæ–‡å­— "è©¦è©¦çœ‹: æ—©é¤ 65"
  And ç”¨æˆ¶å®Œæˆé¦–æ¬¡è¨˜å¸³å¾Œ
  And æ‡‰è§¸ç™¼ OnboardingCompleted äº‹ä»¶
  And æ‡‰è§¸ç™¼ AhaMomentReached äº‹ä»¶
  And æ‡‰é¡¯ç¤ºæ…¶ç¥å‹•ç•« "ğŸ‰ å®Œæˆé¦–æ¬¡è¨˜å¸³!"
```

##### AC4: è·³éå¼•å°

```gherkin
Given ç”¨æˆ¶åœ¨ä»»ä½• Onboarding æ­¥é©Ÿ
When é»æ“Š "è·³é"
Then æ‡‰å°å‘é¦–é 
  And onboardingCompleted æ‡‰ä¿æŒ false
  And ä¸‹æ¬¡ç™»å…¥æ‡‰å†æ¬¡é¡¯ç¤ºå¼•å°
```

##### AC5: Aha Moment è¿½è¹¤

```gherkin
Given ç”¨æˆ¶å®Œæˆé¦–æ¬¡è¨˜å¸³
When AhaMomentReached äº‹ä»¶è§¸ç™¼
Then æ‡‰è¨˜éŒ„åˆ° Analytics:
    | æ¬„ä½              | å€¼              |
    | userId            | ç•¶å‰ç”¨æˆ¶        |
    | trigger           | first_expense   |
    | registrationToAha | 3 åˆ†é˜ï¼ˆç¯„ä¾‹ï¼‰  |
  And æ‡‰ç™¼é€æ­¡è¿ Email
```

#### Technical Notes

- ä½¿ç”¨ react-joyride æˆ–è‡ªå»ºè¼ªæ’­
- å‹•ç•«: Framer Motion
- Analytics: Mixpanel / Google Analytics

#### Definition of Done

- [ ] Unit Test: completeOnboarding() æ–¹æ³•
- [ ] E2E Test: å®Œæ•´å¼•å°æµç¨‹
- [ ] A/B Test è¨­è¨ˆæ–‡ä»¶ï¼ˆæ¸¬è©¦ä¸åŒç‰ˆæœ¬ï¼‰
- [ ] Analytics äº‹ä»¶è¨­å®šå®Œæˆ
- [ ] UX æ¸¬è©¦ï¼ˆ5 ä½ç”¨æˆ¶ï¼‰

#### Dependencies

- éœ€è¦: US-005 (ç”¨æˆ¶ç™»å…¥)
- éœ€è¦: US-001 (AI è§£æè¨˜å¸³)

---

### Story 3.3: Telegram Bot æ•´åˆ

**Story ID**: ES-007
**Epic**: ç”¨æˆ¶æ—…ç¨‹
**Priority**: P2 (Could Have)
**Story Points**: 8

#### User Story

```
As a ç”¨æˆ¶
I want é€é Telegram Bot å¿«é€Ÿè¨˜å¸³
So that æˆ‘ä¸éœ€è¦é–‹å•Ÿ App,åœ¨èŠå¤©ä¸­å°±èƒ½è¨˜å¸³
```

#### Acceptance Criteria

##### AC1: ç¶å®š Telegram å¸³è™Ÿ

```gherkin
Given ç”¨æˆ¶å·²ç™»å…¥ QuickSmart
When ç”¨æˆ¶é€²å…¥è¨­å®šé é¢
  And é»æ“Š "é€£çµ Telegram"
Then æ‡‰é¡¯ç¤º Telegram Bot é€£çµ
  And ç”¨æˆ¶é»æ“Šé€£çµå¾Œæ‡‰é–‹å•Ÿ Telegram
  And è¼¸å…¥ /start å¾Œæ‡‰ç¶å®šæˆåŠŸ
  And æ‡‰è§¸ç™¼ TelegramLinked äº‹ä»¶
  And æ‡‰é¡¯ç¤ºé€šçŸ¥ "Telegram å·²é€£çµ"
```

##### AC2: é€é Bot è¨˜å¸³

```gherkin
Given ç”¨æˆ¶å·²ç¶å®š Telegram
When ç”¨æˆ¶åœ¨ Telegram ç™¼é€ "åˆé¤ 85"
Then Bot æ‡‰å›è¦†:
    | å…§å®¹                          |
    | "âœ… å·²è¨˜å¸³"                   |
    | "é‡‘é¡: NT$85"                 |
    | "åˆ†é¡: é£²é£Ÿ"                  |
    | "ä¿¡å¿ƒåº¦: 95%"                 |
  And æ”¯å‡ºè¨˜éŒ„æ‡‰åŒæ­¥åˆ° QuickSmart
```

##### AC3: é€é Bot æŸ¥è©¢ä»Šæ—¥æ”¯å‡º

```gherkin
Given ç”¨æˆ¶ä»Šå¤©å·²è¨˜ 3 ç­†å¸³
When ç”¨æˆ¶åœ¨ Telegram ç™¼é€ "/today"
Then Bot æ‡‰å›è¦†:
    | å…§å®¹                          |
    | "ä»Šæ—¥æ”¯å‡º: NT$320"            |
    | "æ—©é¤ NT$65"                  |
    | "åˆé¤ NT$85"                  |
    | "å’–å•¡ NT$170"                 |
```

##### AC4: è¨‚é–±æé†’é€é Telegram ç™¼é€

```gherkin
Given ç”¨æˆ¶å·²ç¶å®š Telegram
  And æœ‰ Netflix è¨‚é–±å³å°‡æ‰£æ¬¾
When ç³»çµ±ç™¼é€æé†’
Then Bot æ‡‰ç™¼é€è¨Šæ¯:
    | å…§å®¹                              |
    | "ğŸ”” Netflix å°‡åœ¨ 3 å¤©å¾Œæ‰£æ¬¾"      |
    | "é‡‘é¡: NT$390"                    |
    | "æ‰£æ¬¾æ—¥: 2025-10-15"              |
```

#### Technical Notes

- ä½¿ç”¨ node-telegram-bot-api
- Webhook æ¥æ”¶è¨Šæ¯
- éœ€é©—è­‰ Telegram ID å”¯ä¸€æ€§

#### Definition of Done

- [ ] Unit Test: TelegramBotService æ–¹æ³•
- [ ] Integration Test: Webhook è™•ç†
- [ ] E2E Test: å®Œæ•´ç¶å®š+è¨˜å¸³æµç¨‹
- [ ] Bot å®‰å…¨æ€§æ¸¬è©¦ï¼ˆé˜²æ­¢æ¿«ç”¨ï¼‰
- [ ] Bot éƒ¨ç½²è‡³æ­£å¼ç’°å¢ƒ

#### Dependencies

- éœ€è¦: US-005 (ç”¨æˆ¶ç™»å…¥)
- éœ€è¦: US-001 (AI è§£æ)
- éœ€è¦: US-015 (é€šçŸ¥åŸºç¤è¨­æ–½)

---

## Epic 4: æ™ºèƒ½åˆ†æ

### Story 4.1: æœˆåº¦è³‡æ–™å½™ç¸½

**Story ID**: ES-020
**Epic**: æ™ºèƒ½åˆ†æ
**Priority**: P2 (Could Have)
**Story Points**: 5

#### User Story

```
As a ç”¨æˆ¶
I want æŸ¥çœ‹æ¯æœˆæ”¯å‡ºçµ±è¨ˆèˆ‡åˆ†é¡ä½”æ¯”
So that æˆ‘å¯ä»¥äº†è§£æˆ‘çš„æ¶ˆè²»ç¿’æ…£
```

#### Acceptance Criteria

##### AC1: æœˆåº¦ç¸½è¦½é é¢

```gherkin
Given ç”¨æˆ¶åœ¨ 2025-10 æœ‰ 50 ç­†æ”¯å‡º
When ç”¨æˆ¶é€²å…¥åˆ†æé é¢
  And é¸æ“‡ 2025-10 æœˆ
Then æ‡‰é¡¯ç¤º:
    | æ¬„ä½            | å€¼          |
    | ç¸½æ”¯å‡º          | NT$15,000   |
    | ç­†æ•¸            | 50          |
    | æ—¥å‡æ¶ˆè²»        | NT$500      |
    | æœ€é«˜å–®ç­†        | NT$1,200    |
  And æ‡‰é¡¯ç¤ºåœ“é¤…åœ–ï¼ˆæŒ‰åˆ†é¡ï¼‰
```

##### AC2: åˆ†é¡æ’è¡Œæ¦œ

```gherkin
Given ç”¨æˆ¶æŸ¥çœ‹ 2025-10 æœˆåˆ†æ
Then æ‡‰é¡¯ç¤ºåˆ†é¡æ’è¡Œ:
    | æ’å | åˆ†é¡      | é‡‘é¡      | ä½”æ¯”  |
    | 1    | FOOD      | NT$6,000  | 40%   |
    | 2    | TRANSPORT | NT$3,000  | 20%   |
    | 3    | SHOPPING  | NT$2,500  | 17%   |
  And æ‡‰æ”¯æ´é»æ“Šåˆ†é¡æŸ¥çœ‹æ˜ç´°
```

##### AC3: è¶¨å‹¢åœ–ï¼ˆæœ€è¿‘ 6 å€‹æœˆï¼‰

```gherkin
Given ç”¨æˆ¶æœ‰ 6 å€‹æœˆæ­·å²è³‡æ–™
When é€²å…¥åˆ†æé é¢
Then æ‡‰é¡¯ç¤ºæŠ˜ç·šåœ–:
    | æœˆä»½    | ç¸½æ”¯å‡º    |
    | 2025-05 | NT$12,000 |
    | 2025-06 | NT$14,000 |
    | ...     | ...       |
    | 2025-10 | NT$15,000 |
  And æ‡‰æ¨™è¨˜æœ€é«˜/æœ€ä½æœˆä»½
```

##### AC4: è³‡æ–™å½™ç¸½æ’ç¨‹

```gherkin
Given Cron Job è¨­å®šç‚ºæ¯æœˆ 1 è™ŸåŸ·è¡Œ
When 2025-11-01 00:00 åˆ°é”
Then ç³»çµ±æ‡‰å½™ç¸½ 2025-10 æ‰€æœ‰æ”¯å‡º
  And æ‡‰è§¸ç™¼ MonthlyDataAggregated äº‹ä»¶
  And æ‡‰å¿«å–å½™ç¸½çµæœï¼ˆRedisï¼‰
  And å¿«å–æ‡‰åœ¨ä¸‹æ¬¡å½™ç¸½æ™‚æ›´æ–°
```

#### Technical Notes

- ä½¿ç”¨ Chart.js æˆ– Recharts ç¹ªåœ–
- å¿«å–ç­–ç•¥: Redis 24 å°æ™‚
- è³‡æ–™é‡å¤§æ™‚ä½¿ç”¨è³‡æ–™åº«è¦–åœ–ï¼ˆViewï¼‰

#### Definition of Done

- [ ] Unit Test: å½™ç¸½è¨ˆç®—é‚è¼¯
- [ ] Integration Test: Cron Job åŸ·è¡Œ
- [ ] E2E Test: UI åœ–è¡¨æ¸²æŸ“
- [ ] æ•ˆèƒ½æ¸¬è©¦: 10,000 ç­†è³‡æ–™è¼‰å…¥ < 2s
- [ ] å¿«å–å¤±æ•ˆæ¸¬è©¦

#### Dependencies

- éœ€è¦: US-001 (æ”¯å‡ºè¨˜éŒ„)
- é˜»æ“‹: US-021 (AI æ´å¯Ÿ)

---

### Story 4.2: AI æ™ºèƒ½æ´å¯Ÿç”Ÿæˆ

**Story ID**: ES-021
**Epic**: æ™ºèƒ½åˆ†æ
**Priority**: P2 (Could Have)
**Story Points**: 8

#### User Story

```
As a ç”¨æˆ¶
I want AI åˆ†ææˆ‘çš„æ¶ˆè²»æ¨¡å¼ä¸¦æä¾›å»ºè­°
So that æˆ‘å¯ä»¥æ”¹å–„æˆ‘çš„è²¡å‹™ç‹€æ³
```

#### Acceptance Criteria

##### AC1: ç”Ÿæˆæ´å¯ŸæˆåŠŸ

```gherkin
Given ç”¨æˆ¶æœ‰è‡³å°‘ 30 å¤©çš„æ”¯å‡ºè³‡æ–™
When ç³»çµ±åŸ·è¡Œæ´å¯Ÿç”Ÿæˆï¼ˆæ¯æœˆ 1 è™Ÿï¼‰
Then æ‡‰ä½¿ç”¨ Claude API åˆ†æè³‡æ–™
  And æ‡‰ç”Ÿæˆ 3-5 æ¢æ´å¯Ÿ:
    | é¡å‹              | ç¯„ä¾‹æ–‡å­—                              |
    | æ¶ˆè²»ç¿’æ…£          | "ä½ çš„é£²é£Ÿæ”¯å‡ºä½”ç¸½æ”¯å‡º 40%,é«˜æ–¼å¹³å‡å€¼" |
    | è¶¨å‹¢åˆ†æ          | "æœ¬æœˆäº¤é€šè²»æ¯”ä¸Šæœˆå¢åŠ  25%"            |
    | å»ºè­°              | "è€ƒæ…®ä½¿ç”¨æœˆç¥¨å¯ç¯€çœ NT$500/æœˆ"        |
  And æ‡‰è§¸ç™¼ InsightsGenerated äº‹ä»¶
```

##### AC2: ç•°å¸¸åµæ¸¬

```gherkin
Given ç”¨æˆ¶æœ¬æœˆæœ‰å–®ç­†æ”¯å‡º NT$5,000
  And æœˆå¹³å‡æ”¯å‡ºç‚º NT$1,500
When ç³»çµ±åŸ·è¡Œç•°å¸¸åµæ¸¬
Then æ‡‰è§¸ç™¼ AnomalyDetected äº‹ä»¶
  And æ‡‰æ¨™è¨˜è©²ç­†æ”¯å‡ºç‚ºç•°å¸¸
  And æ‡‰åœ¨æ´å¯Ÿä¸­é¡¯ç¤º "æœ¬æœˆæœ‰ 1 ç­†ç•°å¸¸é«˜é¡æ”¯å‡º"
```

##### AC3: è¶¨å‹¢è­˜åˆ¥

```gherkin
Given ç”¨æˆ¶æœ€è¿‘ 3 å€‹æœˆé£²é£Ÿæ”¯å‡ºæŒçºŒå¢åŠ :
    | æœˆä»½    | é‡‘é¡      |
    | 2025-08 | NT$5,000  |
    | 2025-09 | NT$5,500  |
    | 2025-10 | NT$6,000  |
When ç³»çµ±åˆ†æè¶¨å‹¢
Then æ‡‰è§¸ç™¼ TrendIdentified äº‹ä»¶
  And æ‡‰åœ¨æ´å¯Ÿä¸­é¡¯ç¤º "é£²é£Ÿæ”¯å‡ºå‘ˆä¸Šå‡è¶¨å‹¢ (+20%)"
```

##### AC4: æ´å¯Ÿå±•ç¤ºèˆ‡äº’å‹•

```gherkin
Given ç³»çµ±å·²ç”Ÿæˆæ´å¯Ÿ
When ç”¨æˆ¶é€²å…¥åˆ†æé é¢
Then æ‡‰åœ¨é ‚éƒ¨é¡¯ç¤ºæ´å¯Ÿå¡ç‰‡
  And æ¯å¼µå¡ç‰‡æ‡‰æœ‰:
    | å…ƒç´         |
    | åœ–ç¤º        |
    | æ¨™é¡Œ        |
    | å…§å®¹        |
    | ç›¸é—œæ•¸æ“š    |
  And ç”¨æˆ¶å¯é»æ“Š "æŸ¥çœ‹è©³æƒ…" æ·±å…¥åˆ†æ
```

#### Technical Notes

- ä½¿ç”¨ Claude API (prompt å·¥ç¨‹)
- è‡³å°‘ 30 å¤©è³‡æ–™æ‰åŸ·è¡Œ
- æˆæœ¬æ§åˆ¶: æ¯ç”¨æˆ¶æ¯æœˆ 1 æ¬¡

#### Definition of Done

- [ ] Unit Test: ç•°å¸¸åµæ¸¬é‚è¼¯
- [ ] Integration Test: Claude API æ•´åˆ
- [ ] E2E Test: æ´å¯Ÿé¡¯ç¤ºæµç¨‹
- [ ] Prompt å·¥ç¨‹æ¸¬è©¦ï¼ˆæº–ç¢ºæ€§ï¼‰
- [ ] æˆæœ¬ç›£æ§è¨­å®š

#### Dependencies

- éœ€è¦: US-020 (æœˆåº¦å½™ç¸½)
- éœ€è¦: US-001 (æ”¯å‡ºè¨˜éŒ„)

---

## Epic 5: ç³»çµ±ç©©å®šæ€§

### Story 5.1: å¤šè¨­å‚™åŒæ­¥èˆ‡è¡çªè§£æ±º

**Story ID**: ES-030
**Epic**: ç³»çµ±ç©©å®šæ€§
**Priority**: P1 (Should Have)
**Story Points**: 8

#### User Story

```
As a ç”¨æˆ¶
I want åœ¨å¤šå€‹è£ç½®é–“åŒæ­¥æˆ‘çš„è¨˜å¸³è³‡æ–™
So that æˆ‘å¯ä»¥åœ¨æ‰‹æ©Ÿã€å¹³æ¿ã€é›»è…¦ä¸Šç„¡ç¸«ä½¿ç”¨
```

#### Acceptance Criteria

##### AC1: å³æ™‚åŒæ­¥ï¼ˆæ¨‚è§€æ›´æ–°ï¼‰

```gherkin
Given ç”¨æˆ¶åœ¨æ‰‹æ©Ÿ A æ–°å¢ä¸€ç­†æ”¯å‡º
When æ”¯å‡ºæˆåŠŸå‰µå»º
Then æ‰‹æ©Ÿ A æ‡‰ç«‹å³é¡¯ç¤ºæ–°è¨˜éŒ„ï¼ˆæ¨‚è§€æ›´æ–°ï¼‰
  And æ‡‰ç™¼é€ POST è«‹æ±‚åˆ°ä¼ºæœå™¨
  And ä¼ºæœå™¨å›æ‡‰æˆåŠŸå¾Œæ‡‰ç¢ºèªåŒæ­¥
  And æ‰‹æ©Ÿ Bï¼ˆ5 ç§’å…§ï¼‰æ‡‰è‡ªå‹•æ›´æ–°åˆ—è¡¨
```

##### AC2: ç‰ˆæœ¬è¡çªåµæ¸¬

```gherkin
Given ç”¨æˆ¶åœ¨æ‰‹æ©Ÿ A å’Œæ‰‹æ©Ÿ B åŒæ™‚ç·¨è¼¯åŒä¸€ç­†è¨˜éŒ„
  And æ‰‹æ©Ÿ A å…ˆæäº¤ï¼ˆversion: 1 â†’ 2ï¼‰
When æ‰‹æ©Ÿ B æäº¤ï¼ˆä»ä½¿ç”¨ version: 1ï¼‰
Then ä¼ºæœå™¨æ‡‰æ‹’çµ•æ‰‹æ©Ÿ B çš„æ›´æ–°
  And æ‡‰è§¸ç™¼ SyncConflictDetected äº‹ä»¶
  And æ‰‹æ©Ÿ B æ‡‰æ”¶åˆ° 409 Conflict éŒ¯èª¤
  And æ‡‰æç¤ºç”¨æˆ¶ "æ­¤è¨˜éŒ„å·²è¢«å…¶ä»–è£ç½®ä¿®æ”¹,è«‹é‡æ–°è¼‰å…¥"
```

##### AC3: Last-Write-Wins ç­–ç•¥ï¼ˆMVPï¼‰

```gherkin
Given ç™¼ç”ŸåŒæ­¥è¡çª
When ç”¨æˆ¶é»æ“Š "é‡æ–°è¼‰å…¥"
Then æ‡‰é¡¯ç¤ºä¼ºæœå™¨æœ€æ–°ç‰ˆæœ¬
  And ç”¨æˆ¶å¯é¸æ“‡:
    | é¸é …              |
    | "ä¿ç•™ä¼ºæœå™¨ç‰ˆæœ¬"  |
    | "è¦†è“‹ç‚ºæˆ‘çš„ç‰ˆæœ¬"  |
  And é¸æ“‡å¾Œæ‡‰é‡æ–°æäº¤ï¼ˆä½¿ç”¨æœ€æ–° versionï¼‰
```

##### AC4: é›¢ç·šç·©å­˜èˆ‡æ’éšŠåŒæ­¥

```gherkin
Given ç”¨æˆ¶åœ¨é›¢ç·šç‹€æ…‹ä¸‹æ–°å¢ 3 ç­†æ”¯å‡º
When ç¶²è·¯æ¢å¾©
Then ç³»çµ±æ‡‰è‡ªå‹•åŒæ­¥æ‰€æœ‰å¾…è™•ç†æ“ä½œ
  And æ‡‰æŒ‰æ™‚é–“é †åºæäº¤
  And å¤±æ•—æ“ä½œæ‡‰é‡è©¦ 3 æ¬¡
  And é‡è©¦å¤±æ•—å¾Œæ‡‰é€šçŸ¥ç”¨æˆ¶
```

##### AC5: åŒæ­¥ç‹€æ…‹æŒ‡ç¤º

```gherkin
Given ç”¨æˆ¶åœ¨ç·¨è¼¯è¨˜éŒ„
Then æ‡‰é¡¯ç¤ºåŒæ­¥ç‹€æ…‹åœ–ç¤º:
    | ç‹€æ…‹        | åœ–ç¤º |
    | åŒæ­¥ä¸­      | â³   |
    | åŒæ­¥æˆåŠŸ    | âœ…   |
    | åŒæ­¥å¤±æ•—    | âŒ   |
    | é›¢ç·šæ¨¡å¼    | ğŸ“µ   |
```

#### Technical Notes

- æ¨‚è§€é–: version æ¬„ä½
- é›¢ç·š: IndexedDB + Service Worker
- åŒæ­¥æ©Ÿåˆ¶: WebSocket æˆ–è¼ªè©¢

#### Definition of Done

- [ ] Unit Test: ç‰ˆæœ¬è¡çªåµæ¸¬é‚è¼¯
- [ ] Integration Test: å¤šè£ç½®åŒæ­¥å ´æ™¯
- [ ] E2E Test: é›¢ç·š â†’ ä¸Šç·šåŒæ­¥
- [ ] è¡çªè§£æ±º UX æ¸¬è©¦
- [ ] æ•ˆèƒ½æ¸¬è©¦: 100 ç­†å¾…åŒæ­¥è¨˜éŒ„

#### Dependencies

- éœ€è¦: US-001 (æ”¯å‡º CRUD)

---

### Story 5.2: æ¨æ’­é€šçŸ¥åŸºç¤è¨­æ–½

**Story ID**: ES-015
**Epic**: ç³»çµ±ç©©å®šæ€§
**Priority**: P1 (Should Have)
**Story Points**: 5

#### User Story

```
As a ç³»çµ±ç®¡ç†å“¡
I want å»ºç«‹çµ±ä¸€çš„æ¨æ’­é€šçŸ¥åŸºç¤è¨­æ–½
So that æ‰€æœ‰æ¨¡çµ„å¯ä»¥é€éæ¨™æº– API ç™¼é€é€šçŸ¥
```

#### Acceptance Criteria

##### AC1: ç™¼é€æ¨æ’­é€šçŸ¥æˆåŠŸ

```gherkin
Given ç”¨æˆ¶å·²æˆæ¬Šæ¨æ’­é€šçŸ¥æ¬Šé™
When ç³»çµ±å‘¼å« NotificationAPI.sendPush()
  And å‚³å…¥åƒæ•¸:
    | userId  | "user123"                 |
    | title   | "Netflix å³å°‡æ‰£æ¬¾"        |
    | body    | "å°‡åœ¨ 3 å¤©å¾Œæ‰£æ¬¾ NT$390"  |
    | data    | { deepLink: "/subscriptions/1" } |
Then æ¨æ’­æ‡‰æˆåŠŸç™¼é€
  And æ‡‰è§¸ç™¼ NotificationSent äº‹ä»¶
  And ç”¨æˆ¶è£ç½®æ‡‰é¡¯ç¤ºé€šçŸ¥
```

##### AC2: æ¨æ’­å¤±æ•—é‡è©¦æ©Ÿåˆ¶

```gherkin
Given FCM æœå‹™æš«æ™‚ä¸å¯ç”¨
When ç™¼é€æ¨æ’­å¤±æ•—
Then ç³»çµ±æ‡‰é‡è©¦ 3 æ¬¡ï¼ˆæŒ‡æ•¸é€€é¿ï¼‰
  And é‡è©¦é–“éš”ç‚º 1s, 2s, 4s
  And 3 æ¬¡å¤±æ•—å¾Œæ‡‰è§¸ç™¼ NotificationFailed äº‹ä»¶
  And æ‡‰è¨˜éŒ„éŒ¯èª¤åˆ° Sentry
```

##### AC3: Email å‚™æ´é€šçŸ¥

```gherkin
Given æ¨æ’­é€šçŸ¥ç™¼é€å¤±æ•—
When é‡è©¦ 3 æ¬¡ä»å¤±æ•—
Then ç³»çµ±æ‡‰è‡ªå‹•ç™¼é€ Email
  And Email å…§å®¹æ‡‰èˆ‡æ¨æ’­ç›¸åŒ
  And æ‡‰ä½¿ç”¨ SendGrid ç™¼é€
```

##### AC4: é€šçŸ¥åå¥½è¨­å®š

```gherkin
Given ç”¨æˆ¶é€²å…¥é€šçŸ¥è¨­å®šé é¢
When ç”¨æˆ¶é—œé–‰ "è¨‚é–±æé†’" é–‹é—œ
Then ç³»çµ±æ‡‰è¨˜éŒ„åå¥½è¨­å®š
  And ä¹‹å¾Œä¸æ‡‰ç™¼é€è¨‚é–±ç›¸é—œæ¨æ’­
  And ä½†ä»æ‡‰ç™¼é€ Emailï¼ˆå¦‚æœ‰è¨­å®šï¼‰
```

##### AC5: æ‰¹æ¬¡é€šçŸ¥å„ªåŒ–

```gherkin
Given ç³»çµ±éœ€è¦ç™¼é€ 100 å‰‡é€šçŸ¥
When ä½¿ç”¨æ‰¹æ¬¡ API
Then æ‡‰ä½¿ç”¨ FCM Batch Send
  And æ‡‰é™åˆ¶æ¯æ‰¹ 500 å‰‡
  And æ‡‰è¨˜éŒ„æˆåŠŸ/å¤±æ•—æ•¸é‡
```

#### Technical Notes

- æ¨æ’­: Firebase Cloud Messaging
- Email: SendGrid
- é‡è©¦: Bull Queue + Redis
- é€Ÿç‡é™åˆ¶: 100 req/min

#### Definition of Done

- [ ] Unit Test: NotificationService æ–¹æ³•
- [ ] Integration Test: FCM/SendGrid æ•´åˆ
- [ ] é‡è©¦é‚è¼¯æ¸¬è©¦
- [ ] æ•ˆèƒ½æ¸¬è©¦: 1000 å‰‡é€šçŸ¥ < 10s
- [ ] Monitoring Dashboard è¨­å®š

#### Dependencies

- è¢«é˜»æ“‹æ–¼: US-011 (è¨‚é–±æé†’), US-007 (Telegram)

---

### Story 5.3: ç›£æ§èˆ‡éŒ¯èª¤è¿½è¹¤

**Story ID**: ES-031
**Epic**: ç³»çµ±ç©©å®šæ€§
**Priority**: P1 (Should Have)
**Story Points**: 3

#### User Story

```
As a ç³»çµ±ç®¡ç†å“¡
I want å®Œæ•´çš„ç›£æ§èˆ‡éŒ¯èª¤è¿½è¹¤
So that æˆ‘å¯ä»¥å¿«é€Ÿç™¼ç¾ä¸¦ä¿®å¾©ç³»çµ±å•é¡Œ
```

#### Acceptance Criteria

##### AC1: Sentry éŒ¯èª¤è¿½è¹¤

```gherkin
Given Sentry å·²æ•´åˆåˆ°ç³»çµ±
When ç™¼ç”Ÿæœªæ•ç²çš„ç•°å¸¸
Then æ‡‰è‡ªå‹•è¨˜éŒ„åˆ° Sentry
  And æ‡‰åŒ…å«:
    | æ¬„ä½          |
    | éŒ¯èª¤è¨Šæ¯      |
    | Stack Trace   |
    | ç”¨æˆ¶ ID       |
    | è«‹æ±‚åƒæ•¸      |
    | ç’°å¢ƒè³‡è¨Š      |
  And æ‡‰ç™¼é€ Slack å‘Šè­¦ï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰
```

##### AC2: API æ•ˆèƒ½ç›£æ§

```gherkin
Given Prometheus å·²è¨­å®š
When API ç«¯é»è¢«å‘¼å«
Then æ‡‰è¨˜éŒ„æŒ‡æ¨™:
    | æŒ‡æ¨™åç¨±              | é¡å‹        |
    | http_request_duration | Histogram   |
    | http_request_total    | Counter     |
    | ai_parse_duration     | Histogram   |
    | ai_fallback_count     | Counter     |
  And æ‡‰åœ¨ Grafana Dashboard é¡¯ç¤º
```

##### AC3: æ¥­å‹™æŒ‡æ¨™ç›£æ§

```gherkin
Given ç³»çµ±æ­£å¸¸é‹ä½œ
Then æ‡‰è¿½è¹¤æ¥­å‹™æŒ‡æ¨™:
    | æŒ‡æ¨™                  |
    | æ¯æ—¥æ´»èºç”¨æˆ¶ (DAU)    |
    | è¨˜å¸³æˆåŠŸç‡            |
    | AI æº–ç¢ºç‡             |
    | é™ç´šæ¨¡å¼ä½¿ç”¨ç‡        |
    | è¨‚é–±æé†’é€é”ç‡        |
  And æ‡‰æ¯æ—¥ç”¢ç”Ÿå ±å‘Š
```

##### AC4: å‘Šè­¦è¦å‰‡è¨­å®š

```gherkin
Given ç›£æ§ç³»çµ±é‹ä½œä¸­
When è§¸ç™¼ä»¥ä¸‹æ¢ä»¶:
    | æ¢ä»¶                        | å‘Šè­¦ç­‰ç´š |
    | API P95 å»¶é² > 3s           | Warning  |
    | éŒ¯èª¤ç‡ > 1%                 | Critical |
    | é™ç´šæ¨¡å¼ä½¿ç”¨ > 10min        | Warning  |
    | è³‡æ–™åº«é€£ç·šå¤±æ•—              | Critical |
Then æ‡‰ç™¼é€å°æ‡‰ç­‰ç´šçš„ Slack å‘Šè­¦
  And Critical ç­‰ç´šæ‡‰åŒæ™‚ç™¼é€ Email
```

#### Technical Notes

- Sentry: éŒ¯èª¤è¿½è¹¤
- Prometheus + Grafana: æŒ‡æ¨™ç›£æ§
- Slack Webhook: å‘Šè­¦é€šçŸ¥

#### Definition of Done

- [ ] Sentry æ•´åˆå®Œæˆ
- [ ] Prometheus + Grafana è¨­å®šå®Œæˆ
- [ ] æ‰€æœ‰ API ç«¯é»åŠ å…¥æŒ‡æ¨™
- [ ] å‘Šè­¦è¦å‰‡æ¸¬è©¦
- [ ] Runbook æ–‡ä»¶å®Œæˆ

#### Dependencies

- ç„¡ï¼ˆåŸºç¤è¨­æ–½ï¼‰

---

## ğŸ”— Story ç›¸ä¾æ€§åœ–

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   US-005     â”‚
                    â”‚  ç”¨æˆ¶è¨»å†Š    â”‚
                    â”‚  (Priority 0)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚               â”‚               â”‚
           â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  US-001  â”‚    â”‚  US-006  â”‚    â”‚  US-010  â”‚
    â”‚ AI è§£æ  â”‚    â”‚ Onboardingâ”‚    â”‚æ–°å¢è¨‚é–±  â”‚
    â”‚  (P0)    â”‚    â”‚  (P1)    â”‚    â”‚  (P1)    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚                                â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
         â”‚            â”‚                   â”‚
         â–¼            â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  US-002  â”‚ â”‚  US-003  â”‚      â”‚  US-011  â”‚
    â”‚ AI é™ç´š  â”‚ â”‚ åˆ†é¡ä¿®æ­£ â”‚      â”‚ æ‰£æ¬¾æé†’ â”‚
    â”‚  (P0)    â”‚ â”‚  (P1)    â”‚      â”‚  (P1)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚                               â”‚
         â”‚                               â”‚
         â–¼                               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  US-004  â”‚                   â”‚  US-012  â”‚
    â”‚æ”¯å‡º CRUD â”‚                   â”‚è‡ªå‹•è¨˜å¸³  â”‚
    â”‚  (P0)    â”‚                   â”‚  (P1)    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  US-020  â”‚
    â”‚æœˆåº¦å½™ç¸½  â”‚
    â”‚  (P2)    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  US-021  â”‚
    â”‚ AI æ´å¯Ÿ  â”‚
    â”‚  (P2)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  US-015  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚æ¨æ’­åŸºç¤  â”‚            â”‚
    â”‚  (P1)    â”‚            â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚
         â”‚                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         (è¢« US-011, US-007 ä¾è³´)

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  US-030  â”‚
    â”‚å¤šè¨­å‚™åŒæ­¥â”‚
    â”‚  (P1)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    (å¯ç¨ç«‹é–‹ç™¼)

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  US-031  â”‚
    â”‚  ç›£æ§    â”‚
    â”‚  (P1)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    (å¯ç¨ç«‹é–‹ç™¼)
```

---

## ğŸ“… Sprint è¦åŠƒå»ºè­°

### Sprint 0: åŸºç¤è¨­æ–½ï¼ˆ2 weeksï¼‰

| Story ID | æ¨™é¡Œ           | Points | å„ªå…ˆç´š |
|----------|----------------|--------|--------|
| US-005   | ç”¨æˆ¶è¨»å†Šç™»å…¥   | 5      | P0     |
| US-015   | æ¨æ’­é€šçŸ¥åŸºç¤   | 5      | P1     |
| US-031   | ç›£æ§éŒ¯èª¤è¿½è¹¤   | 3      | P1     |

**Sprint ç›®æ¨™**: å»ºç«‹æ ¸å¿ƒåŸºç¤è¨­æ–½,ç¢ºä¿å¾ŒçºŒåŠŸèƒ½å¯é †åˆ©é–‹ç™¼

**é©—æ”¶æ¨™æº–**:
- ç”¨æˆ¶å¯æˆåŠŸè¨»å†Šç™»å…¥
- æ¨æ’­é€šçŸ¥å¯æ­£å¸¸ç™¼é€
- Sentry + Grafana æ­£å¸¸é‹ä½œ

---

### Sprint 1: MVP æ ¸å¿ƒåŠŸèƒ½ï¼ˆ2 weeksï¼‰

| Story ID | æ¨™é¡Œ           | Points | å„ªå…ˆç´š |
|----------|----------------|--------|--------|
| US-001   | AI è‡ªç„¶èªè¨€è§£æ| 8      | P0     |
| US-002   | AI é™ç´šæ©Ÿåˆ¶    | 5      | P0     |

**Sprint ç›®æ¨™**: å¯¦ç¾å¿«é€Ÿè¨˜å¸³æ ¸å¿ƒåŠŸèƒ½

**é©—æ”¶æ¨™æº–**:
- ç”¨æˆ¶å¯è¼¸å…¥è‡ªç„¶èªè¨€è¨˜å¸³
- AI å¤±æ•ˆæ™‚è‡ªå‹•é™ç´š
- è¨˜å¸³æˆåŠŸç‡ >= 95%

---

### Sprint 2: è¨˜å¸³å®Œæ•´åŠŸèƒ½ï¼ˆ2 weeksï¼‰

| Story ID | æ¨™é¡Œ           | Points | å„ªå…ˆç´š |
|----------|----------------|--------|--------|
| US-003   | åˆ†é¡ä¿®æ­£èˆ‡å­¸ç¿’ | 5      | P1     |
| US-004   | æ”¯å‡ºè¨˜éŒ„ CRUD  | 3      | P0     |
| US-006   | Onboarding æµç¨‹| 5      | P1     |

**Sprint ç›®æ¨™**: å®Œå–„è¨˜å¸³åŠŸèƒ½èˆ‡ç”¨æˆ¶é«”é©—

**é©—æ”¶æ¨™æº–**:
- ç”¨æˆ¶å¯ä¿®æ­£åˆ†é¡
- æ”¯å‡º CRUD å®Œæ•´
- æ–°ç”¨æˆ¶å®Œæˆå¼•å°æµç¨‹

---

### Sprint 3: è¨‚é–±ç®¡ç†ï¼ˆ2 weeksï¼‰

| Story ID | æ¨™é¡Œ           | Points | å„ªå…ˆç´š |
|----------|----------------|--------|--------|
| US-010   | æ–°å¢è¨‚é–±æœå‹™   | 5      | P1     |
| US-011   | è¨‚é–±æ‰£æ¬¾æé†’   | 8      | P1     |

**Sprint ç›®æ¨™**: å¯¦ç¾è¨‚é–±ç®¡ç†åŠŸèƒ½

**é©—æ”¶æ¨™æº–**:
- ç”¨æˆ¶å¯æ–°å¢è¨‚é–±
- æé†’æ­£å¸¸ç™¼é€ï¼ˆ3å¤©ã€1å¤©ã€ç•¶å¤©ï¼‰
- æ—¥æœŸè¨ˆç®—é‚Šç•Œæ¡ˆä¾‹é€šé

---

### Sprint 4: è¨‚é–±é€²éšåŠŸèƒ½ï¼ˆ2 weeksï¼‰

| Story ID | æ¨™é¡Œ           | Points | å„ªå…ˆç´š |
|----------|----------------|--------|--------|
| US-012   | è¨‚é–±è‡ªå‹•è¨˜å¸³   | 5      | P1     |
| US-013   | è¨‚é–±ç®¡ç†æ“ä½œ   | 3      | P2     |
| US-030   | å¤šè¨­å‚™åŒæ­¥     | 8      | P1     |

**Sprint ç›®æ¨™**: å®Œå–„è¨‚é–±åŠŸèƒ½èˆ‡å¤šè¨­å‚™æ”¯æ´

**é©—æ”¶æ¨™æº–**:
- è‡ªå‹•è¨˜å¸³æ­£å¸¸é‹ä½œ
- ç”¨æˆ¶å¯æš«åœ/å–æ¶ˆè¨‚é–±
- å¤šè¨­å‚™åŒæ­¥ç„¡è¡çª

---

### Sprint 5: æ™ºèƒ½åˆ†æï¼ˆ2 weeksï¼‰

| Story ID | æ¨™é¡Œ           | Points | å„ªå…ˆç´š |
|----------|----------------|--------|--------|
| US-020   | æœˆåº¦è³‡æ–™å½™ç¸½   | 5      | P2     |
| US-021   | AI æ™ºèƒ½æ´å¯Ÿ    | 8      | P2     |

**Sprint ç›®æ¨™**: æä¾›è³‡æ–™åˆ†æåŠŸèƒ½

**é©—æ”¶æ¨™æº–**:
- æœˆåº¦çµ±è¨ˆæ­£ç¢º
- AI æ´å¯Ÿæœ‰åƒ¹å€¼
- åœ–è¡¨æ¸²æŸ“æµæš¢

---

### Sprint 6: é€²éšåŠŸèƒ½ï¼ˆ2 weeksï¼‰

| Story ID | æ¨™é¡Œ           | Points | å„ªå…ˆç´š |
|----------|----------------|--------|--------|
| US-007   | Telegram Bot   | 8      | P2     |

**Sprint ç›®æ¨™**: æä¾›é¡å¤–é€šè·¯

**é©—æ”¶æ¨™æº–**:
- Telegram Bot æ­£å¸¸é‹ä½œ
- å¯é€é Bot è¨˜å¸³èˆ‡æŸ¥è©¢

---

## ğŸ“Š ç¸½é«”çµ±è¨ˆ

### Story Points åˆ†å¸ƒ

| Epic           | Story æ•¸é‡ | ç¸½ Points | å¹³å‡ Points |
|----------------|-----------|-----------|-------------|
| å¿«é€Ÿè¨˜å¸³       | 4         | 21        | 5.25        |
| è¨‚é–±ç®¡ç†       | 4         | 21        | 5.25        |
| ç”¨æˆ¶æ—…ç¨‹       | 3         | 18        | 6.0         |
| æ™ºèƒ½åˆ†æ       | 2         | 13        | 6.5         |
| ç³»çµ±ç©©å®šæ€§     | 3         | 16        | 5.33        |
| **ç¸½è¨ˆ**       | **16**    | **89**    | **5.56**    |

### å„ªå…ˆç´šåˆ†å¸ƒ

| å„ªå…ˆç´š | Story æ•¸é‡ | ç¸½ Points |
|--------|-----------|-----------|
| P0     | 5         | 29        |
| P1     | 8         | 44        |
| P2     | 3         | 16        |

### å»ºè­°åœ˜éšŠé…ç½®

- **å¾Œç«¯å·¥ç¨‹å¸«**: 2 äººï¼ˆvelocity: 13 points/sprintï¼‰
- **å‰ç«¯å·¥ç¨‹å¸«**: 1 äººï¼ˆvelocity: 8 points/sprintï¼‰
- **é ä¼°æ™‚ç¨‹**: 6 sprints (12 weeks)

---

## âœ… Story å“è³ªæª¢æŸ¥æ¸…å–®

æ¯å€‹ Story æ‡‰æ»¿è¶³:

- [ ] ç¬¦åˆ INVEST åŸå‰‡
- [ ] æœ‰æ˜ç¢ºçš„ ACï¼ˆGiven-When-Then æ ¼å¼ï¼‰
- [ ] Story Points å·²ä¼°ç®—
- [ ] ç›¸ä¾æ€§å·²è­˜åˆ¥
- [ ] Technical Notes å®Œæ•´
- [ ] Definition of Done æ˜ç¢º
- [ ] å¯åœ¨ 1-2 Sprint å…§å®Œæˆ

---

## ğŸ“ æ–‡ä»¶ç¶­è­·

- ç•¶éœ€æ±‚è®Šæ›´æ™‚,æ›´æ–°å°æ‡‰ Story çš„ AC
- ç•¶æŠ€è¡“æ–¹æ¡ˆèª¿æ•´æ™‚,æ›´æ–° Technical Notes
- æ¯å€‹ Sprint çµæŸå¾Œ,å›é¡§ Story Points ä¼°ç®—æº–ç¢ºæ€§
- å®šæœŸï¼ˆæ¯æœˆï¼‰èˆ‡ EVENT_STORMING.md åŒæ­¥æ›´æ–°

**ç‰ˆæœ¬**: v1.0
**æœ€å¾Œæ›´æ–°**: 2025-10-20
**ä¸‹æ¬¡å¯©æŸ¥**: Sprint Review æ™‚

---

## ğŸ¯ æˆåŠŸæŒ‡æ¨™

### é–‹ç™¼æ•ˆç‡æŒ‡æ¨™

- Story å®Œæˆç‡ >= 90%
- Sprint Velocity ç©©å®šåº¦ï¼ˆè®Šç•°ä¿‚æ•¸ < 20%ï¼‰
- æŠ€è¡“å‚µæ¯”ä¾‹ < 10%

### ç”¢å“å“è³ªæŒ‡æ¨™

- æ¸¬è©¦è¦†è“‹ç‡ >= 85%
- ç”Ÿç”¢ç’°å¢ƒéŒ¯èª¤ç‡ < 0.5%
- API P95 å›æ‡‰æ™‚é–“ < 1s

### ç”¨æˆ¶æ»¿æ„åº¦æŒ‡æ¨™

- Onboarding å®Œæˆç‡ >= 60%
- Aha Moment åˆ°é”ç‡ >= 70%
- æœˆæ´»èºç”¨æˆ¶ç•™å­˜ç‡ >= 40%

---

**é™„è¨»**: æœ¬æ–‡ä»¶åŸºæ–¼ EVENT_STORMING.md çš„é ˜åŸŸçŸ¥è­˜ç”Ÿæˆ,æ‰€æœ‰ AC å‡ä½¿ç”¨ BDD Given-When-Then æ ¼å¼,ç¢ºä¿é–‹ç™¼èˆ‡æ¸¬è©¦äººå“¡æœ‰å…±åŒèªè¨€ã€‚
